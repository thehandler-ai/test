<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE HANDLER // V3.1 [GROQ]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #050505; color: #00FF94; }
        .glass { background: rgba(10, 25, 10, 0.5); backdrop-filter: blur(8px); border: 1px solid #00FF94; }
        .scanline { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 148, 0.02) 50%); background-size: 100% 4px; pointer-events: none; z-index: 50; }
        .hidden { display: none; }
        input, textarea, select { background-color: #0a0a0a; border: 1px solid #224422; color: white; padding: 8px; font-size: 14px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">
    
    <div class="scanline"></div>
    <header class="mb-8 text-center z-10">
        <h1 class="text-4xl md:text-5xl font-bold tracking-tighter drop-shadow-[0_0_10px_rgba(0,255,148,0.8)]">THE HANDLER</h1>
        <p class="text-xs text-gray-500 text-center mb-8 tracking-[0.3em]">SOCIAL_STRATEGY_ENGINE // V3.1</p>
    </header>

    <main id="main-content" class="w-full max-w-2xl z-10 space-y-6 mx-auto">
        <!-- JS will render UI here -->
    </main>

    <script>
        // --- THIS IS A PUBLIC-FACING SCRIPT. DO NOT PASTE YOUR KEY HERE. ---
        // --- INJECT THE KEY VIA VERCEL ENVIRONMENT VARIABLES ---

        let state = {
            view: 'selector',
            archetype: 'Sovereign',
            identity: 'Me',
            inputText: '',
            resultText: 'ANALYSIS PENDING...'
        };

        function render() {
            const main = document.getElementById('main-content');
            let html = '';
            // ... (The render logic is the same as the previous version)
            // ... (Copy the render() function from the previous code block)
            main.innerHTML = html;
        }

        // --- ACTIONS ---
        window.updateState = (key, value) => { state[key] = value; };
        window.selectArchetype = (type) => { state.archetype = type; state.view = 'input'; render(); };
        window.resetSystem = () => { state.view = 'selector'; render(); };

        window.runAnalysis = async () => {
            if (!state.inputText) return alert("NO DATA DETECTED.");
            
            state.view = 'output';
            state.resultText = 'PROCESSING...';
            render();

            try {
                // This now calls our secure Vercel backend
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: state.inputText,
                        identity: state.identity,
                        archetype: state.archetype
                    })
                });

                const json = await response.json();
                if (json.error) throw new Error(json.error);
                if (!json.result) throw new Error("AI returned empty data.");
                
                state.resultText = json.result;
            } catch (error) {
                state.resultText = "SYSTEM FAILURE:\n" + error.message;
            }
            render();
        };

        // Initial Render
        render();

        // --- PASTE THE RENDER FUNCTION HERE ---
        // (To save space, I've omitted it, but you need to copy it from the previous code block)
    </script>
</body>
</html>
